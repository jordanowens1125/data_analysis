from nba_api.stats.endpoints import shotchartdetail
import numpy as np
import pandas as pd
import seaborn as sns
import matplotlib.pyplot as plt
import matplotlib as mpl
import matplotlib.font_manager as fm
from matplotlib.patches import Circle, Rectangle, Arc, ConnectionPatch
import matplotlib.patches as mpatches


from nba_api.stats.static import players
from nba_api.stats.static import teams
player_list = players.get_players()
team_list = teams.get_teams()


#Team and player dataframe
teamdf = pd.DataFrame(team_list,
                      columns = ['id', 'full_name',
                                 'abbreviation', 'nickname', 'city',
                                 'state','year_founded'])
                                 
playerdf = pd.DataFrame(player_list,columns = ['id','full_name',
                                               'first_name','last_name','is_active',] )

#rename id columns
teamdf = teamdf.rename(columns={'id':'team_id'})
playerdf = playerdf.rename(columns={'id':'player_id'})


#Reset index
playerdf = playerdf.reset_index()
teamdf = teamdf.reset_index()


#Exploring data
teamdf.columns
teamdf.head(30)

playerdf.head(10)

#Get stephen curry player id
curryid = playerdf[playerdf['full_name']=='Stephen Curry'].player_id

#
import requests
import json

url_base = 'https://stats.nba.com/stats/shotchartdetail'

headers = {
		'Host': 'stats.nba.com',
		'Connection': 'keep-alive',
		'Accept': 'application/json, text/plain, */*',
		'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36',
		'Referer': 'https://stats.nba.com/',
		"x-nba-stats-origin": "stats",
		"x-nba-stats-token": "true",
		'Accept-Encoding': 'gzip, deflate, br',
		'Accept-Language': 'en-US,en;q=0.9',
	}

parameters = {
	'ContextMeasure': 'FGA',
	'LastNGames': 0,
	'LeagueID': '00',
	'Month': 0,
	'OpponentTeamID': 0,
	'Period': 0,
	'PlayerID': curryid,
	'SeasonType': 'Regular Season',
	'TeamID': 0,
	'VsDivision': '',
	'VsConference': '',
	'SeasonSegment': '',
	'Season': '',
	'RookieYear': '',
	'PlayerPosition': '',
	'Outcome': '',
	'Location': '',
	'GameSegment': '',
	'GameId': '',
	'DateTo': '',
	'DateFrom': ''
}


response = requests.get(url_base, params=parameters, headers=headers)
content = json.loads(response.content)


# transform contents into dataframe
results = content['resultSets'][0]
headers = results['headers']
rows = results['rowSet']
df = pd.DataFrame(rows)
df.columns = headers

#Getting glimpse of curry shot chart dataset
df.info()
df.head()
df.describe()


